# Supabase Setup Guide

## Table Structure

Create a table named `scores` in your Supabase project with the following structure:

```sql
CREATE TABLE scores (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    player_name VARCHAR(100) NOT NULL,
    score INTEGER NOT NULL,
    streak INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Create index for faster queries
CREATE INDEX idx_scores_score ON scores(score DESC);
CREATE INDEX idx_scores_created_at ON scores(created_at DESC);
```

## Row Level Security (RLS) Policies

Enable RLS and set up policies to allow public read/write access:

```sql
-- Enable RLS
ALTER TABLE scores ENABLE ROW LEVEL SECURITY;

-- Allow anyone to insert scores
CREATE POLICY "Allow public insert" ON scores
    FOR INSERT
    TO anon
    WITH CHECK (true);

-- Allow anyone to read scores
CREATE POLICY "Allow public select" ON scores
    FOR SELECT
    TO anon
    USING (true);
```

## CORS Configuration

Add your domain to Supabase CORS settings:

1. Go to your Supabase project dashboard
2. Navigate to Settings → API
3. Add your domain to "Additional Redirect URLs" if needed
4. For local development: `http://localhost:3000`

## Testing the Connection

After setting up the table:

1. Start the server: `npm start`
2. Open `http://localhost:3000` in your browser
3. Play a game and check if scores are saved
4. Check the browser console for logs (✅ for success, ❌ for errors)

## Troubleshooting

### "Supabase not configured" error
- Make sure the server is running
- Check that `.env` file exists in the project root
- Verify the `/api/config` endpoint is accessible

### Scores not saving
- Check browser console for error messages
- Verify the `scores` table exists in Supabase
- Ensure RLS policies are set correctly
- Check that the Supabase URL and Key in `.env` are correct

### CORS errors
- Add your domain to Supabase CORS settings
- For local development, add `http://localhost:3000`

## Security Notes

- ⚠️ **Never commit `.env` file to git** - it's already in `.gitignore`
- The anon key is safe to use in client-side code, but with proper RLS policies
- For production, consider implementing authentication for better security
- Consider adding rate limiting to prevent abuse
